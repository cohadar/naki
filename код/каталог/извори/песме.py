from каталог.__main__ import Картограф
from collections import namedtuple


Извор = namedtuple('извор', ['ид', 'датум', 'наслов', 'строфа1', 'строфа2'])


def направи_линк(ид, наслов):
    return [ид, f"https://soundcloud.com/search?q={наслов}"]


def извор_одради(кг):
    карте = []
    линкови = []
    индекс = iter(range(16))

    for и, строфе in enumerate(кг.извор):
        цкг = Картограф(кг.лепа_путања, [строфе], старт=next(индекс))
        ка = цкг(f"СТРОФА {и}", Извор.строфа1.fget, Извор.строфа2.fget)
        линкови.extend([направи_линк(к[0], кг.извор[0].наслов) for к in ка])
        карте.extend(ка)

    return карте, линкови


def извор_учитај(путања):
    with open(путања, 'r') as ф:
        линије = [линија.strip() for линија in ф.readlines()]
    ид, датум = линије[0].split('\t')
    линије = линије[1:]
    песма = []
    строфа = []
    for линија in линије:
        if линија:
            строфа.append(линија)
        else:
            песма.append(строфа)
            строфа = []
    if строфа:
        песма.append(строфа)
    песма = ['\\n'.join(строфа) for строфа in песма]
    return [Извор(ид, датум, линије[0], строфа1, строфа2) for строфа1, строфа2 in zip(песма[:-1], песма[1:])]

